import { PortfolioData, DiagnosisResult, DiagnosisType } from '@/types/portfolio';

const diagnosisData: Record<DiagnosisType, Omit<DiagnosisResult, 'stats'>> = {
  gambler: {
    type: 'gambler',
    emoji: 'üé≤',
    title: '‰∏ÄÁÇπÁ™ÅÁ†¥„ÅÆ„ÇÆ„É£„É≥„Éñ„É©„ÉºÂûã',
    condition: 'ÊöóÂè∑Ë≥áÁî£ Ôºã ÂÄãÂà•Ê†™ Ôºû 60%',
    diagnosis: 'Êîª„ÇÅ„ÅÆÂßøÂã¢„ÅØÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Åå„ÄÅ2026Âπ¥„ÅÆËçíÊ≥¢„ÅßËª¢Ë¶Ü„Åô„ÇãÊÅê„Çå„ÅÇ„Çä„ÄÇÈ´ò„É™„Çπ„ÇØË≥áÁî£„Å∏„ÅÆÈõÜ‰∏≠ÊäïË≥á„ÅØ„ÄÅÂ§ß„Åç„Å™„É™„Çø„Éº„É≥„ÇíÁãô„Åà„ÇãÂèçÈù¢„ÄÅÂ∏ÇÂ†¥„ÅÆÊÄ•Â§âÂãï„Å´ÂØæ„Åó„Å¶ËÑÜÂº±„Åß„Åô„ÄÇ',
    newsForecast: 'Ë¶èÂà∂Âº∑Âåñ„ÇÑ„Çª„ÇØ„Çø„Éº„É≠„Éº„ÉÜ„Éº„Ç∑„Éß„É≥„Åß„ÄÅË≥áÁî£„Åå‰∏ÄÊôÇÁöÑ„Å´ÂçäÊ∏õ„Åô„Çã„Éã„É•„Éº„Çπ„ÅåÊµÅ„Çå„Çã„Åã„ÇÇÔºü2026Âπ¥„ÅØÂêÑÂõΩ„ÅÆÈáëËûçÊîøÁ≠ñ„ÅÆËª¢ÊèõÁÇπ„Å®„Å™„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„ÄÅ„Éú„É©„ÉÜ„Ç£„É™„ÉÜ„Ç£„ÅÆÈ´ò„ÅÑË≥áÁî£„ÅØÁâπ„Å´Ê≥®ÊÑè„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ',
    cleanupAdvice: [
      { action: 'üóëÔ∏è Êç®„Å¶„Çã', description: 'ÂÄ§Âãï„Åç„ÅÆÊøÄ„Åó„Åô„Åé„ÇãËçâ„Ç≥„Ç§„É≥„ÇÑÂ∞èÂûãÊ†™„ÅÆ‰∏ÄÈÉ®„ÄÇÂà©Áõä„ÅåÂá∫„Å¶„ÅÑ„Çã„Å™„Çâ‰ªä„ÅÆ„ÅÜ„Å°„Å´Âà©Á¢∫„Çí„ÄÇ' },
      { action: '‚ú® Êãæ„ÅÜ', description: '„ÄåÈáëÔºà„Ç¥„Éº„É´„ÉâÔºâ„Äç„Åæ„Åü„ÅØ„ÄåÂÇµÂà∏Á≥ªETF„Äç„ÄÇÂÆà„Çä„ÅÆÁõæ„ÇíË£ÖÂÇô„Åó„Å¶„ÄÅ„Éù„Éº„Éà„Éï„Ç©„É™„Ç™ÂÖ®‰Ωì„ÅÆ„É™„Çπ„ÇØ„ÇíËªΩÊ∏õ„Åó„Åæ„Åó„Çá„ÅÜÔºÅ' }
    ]
  },
  safekeeper: {
    type: 'safekeeper',
    emoji: 'üîê',
    title: 'Áü≥Ê©ã„ÇíÂè©„Åç„Åô„Åé„ÇãÈáëÂ∫´Áï™Âûã',
    condition: 'ÁèæÈáë Ôºã Èáë Ôºû 70%',
    diagnosis: 'ÂÆâÂÖ®ÊÄß„ÅØÊúÄÂº∑„Åß„Åô„Åå„ÄÅ„Ç§„É≥„Éï„É¨„Å®„ÅÑ„ÅÜ„ÄåË¶ã„Åà„Å™„ÅÑÊ≥•Ê£í„Äç„Å´Ë≥áÁî£„ÇíÂâä„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ2026Âπ¥„ÇÇÁâ©‰æ°‰∏äÊòá„ÅåÁ∂ö„ÅèË¶ãÈÄö„Åó„Åß„ÄÅÂÆüË≥™ÁöÑ„Å™Ë≥ºË≤∑Âäõ„ÅåÁõÆÊ∏õ„Çä„Åô„Çã„É™„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ',
    newsForecast: 'Áâ©‰æ°‰∏äÊòáÁéá„ÅåÈ†êÈáëÈáëÂà©„Çí‰∏äÂõû„Çä„ÄÅÂÆüË≥™Ë≥áÁî£„ÅåÁõÆÊ∏õ„Çä„Åó„Åü„Å®„ÅÑ„ÅÜ„Éã„É•„Éº„Çπ„Å´ÊÑïÁÑ∂„Å®„Åô„Çã„Åã„ÇÇ„ÄÇÊó•ÈäÄ„ÅÆÈáëËûçÊîøÁ≠ñÊ≠£Â∏∏Âåñ„ÅåÈÄ≤„ÇÄ‰∏≠„ÄÅÈ†êÈáë„Å†„Åë„Åß„ÅØË≥áÁî£Èò≤Ë°õ„ÅåÈõ£„Åó„ÅÑÊôÇ‰ª£„Å´„ÄÇ',
    cleanupAdvice: [
      { action: 'üóëÔ∏è Êç®„Å¶„Çã', description: 'ÈÅéÂâ∞„Å™ÁèæÈáëÔºàÁîüÊ¥ªÈò≤Ë°õË≥áÈáë‰ª•Â§ñÔºâ„ÄÇÁú†„Çâ„Åõ„Å¶„Åä„Åè„Å†„Åë„Åß„ÅØ„ÇÇ„Å£„Åü„ÅÑ„Å™„ÅÑÔºÅ' },
      { action: '‚ú® Êãæ„ÅÜ', description: '„ÄåÂÖ®‰∏ñÁïåÊ†™ÂºèÔºà„Ç™„É´„Ç´„É≥Ôºâ„Äç„ÇÑ„ÄåS&P500„Äç„ÄÇÁéãÈÅì„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÈÅãÁî®„Åß„Ç®„É≥„Ç∏„É≥„ÇíÂßãÂãï„Åï„Åõ„Åæ„Åó„Çá„ÅÜÔºÅ' }
    ]
  },
  trendy: {
    type: 'trendy',
    emoji: 'ü¶ó',
    title: 'ÊµÅË°å„ÇäÁâ©Â•Ω„Åç„ÅÆ„Ç§„Éä„Ç¥Âûã',
    condition: 'ÊöóÂè∑Ë≥áÁî£ Ôºû 30% „Åã„Å§ Êäï‰ø°/ETF Ôºú 20%',
    diagnosis: 'Ë©±È°å„ÅÆË≥áÁî£„Å´È£õ„Å≥„Å§„Åç„Åå„Å°„ÄÇË∂≥ÂÖÉ„ÅÆÂú∞Áõ§Ôºà„Ç≥„Ç¢Ë≥áÁî£Ôºâ„Åå„Çπ„Ç´„Çπ„Ç´„Åß„Åô„ÄÇSNS„ÇÑ„Éã„É•„Éº„Çπ„ÅßË©±È°å„Å´„Å™„Å£„ÅüÈäòÊüÑ„Å´ÈõÜ‰∏≠ÊäïË≥á„Åô„ÇãÂÇæÂêë„Åå„ÅÇ„Çä„ÄÅÂú∞ÈÅì„Å™Á©çÁ´ãÊäïË≥á„ÅåÁñé„Åã„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ',
    newsForecast: 'ÊµÅË°å„ÅÆ„ÉÜ„Éº„ÉûÊ†™„ÅåÊö¥ËêΩ„ÄÇSNS„ÅßÊÇ≤È≥¥„Çí‰∏ä„Åí„Çã„Åì„Å®„Å´„Å™„Çã„Åã„ÇÇÔºü2026Âπ¥„ÅØ‰ªÆÊÉ≥ÈÄöË≤®Ë¶èÂà∂„ÇÑAI„Éê„Éñ„É´Â¥©Â£ä„Å™„Å©„ÄÅ„Éà„É¨„É≥„ÉâË≥áÁî£„ÅÆÊÄ•ËêΩ„É™„Çπ„ÇØ„Å´Ë≠¶Êàí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ',
    cleanupAdvice: [
      { action: 'üìä Êï¥„Åà„Çã', description: 'ÊöóÂè∑Ë≥áÁî£„ÅÆÂà©Áõä„ÅåÂá∫„Å¶„ÅÑ„Çã„Å™„Çâ‰∏ÄÈÉ®Âà©Á¢∫„ÄÇ„ÄåÊ¨≤Âºµ„Çä„Åô„Åé„Å™„ÅÑ„Äç„ÅåÈï∑ÊúüÊäïË≥á„ÅÆÈâÑÂâá„Åß„Åô„ÄÇ' },
      { action: '‚ú® Êãæ„ÅÜ', description: '„ÄåÈ´òÈÖçÂΩìETF„Äç„ÇÑ„Äå‰∏çÂãïÁî£ÔºàREITÔºâ„Äç„ÄÇ„ÉÅ„É£„É™„É≥„ÉÅ„É£„É™„É≥„Å®ÂÖ•„Çã„Ç§„É≥„Ç´„É†„ÅßÂøÉ„ÇíËêΩ„Å°ÁùÄ„Åã„Åõ„Å¶„ÄÇ' }
    ]
  },
  balanced: {
    type: 'balanced',
    emoji: 'üåü',
    title: '„Éê„É©„É≥„ÇπÈáçË¶ñ„ÅÆÂÑ™Á≠âÁîüÂûã',
    condition: 'Êäï‰ø°/ETF„Åå40„Äú60%„ÄÅ„Åã„Å§ÁèæÈáë„Å®„Åù„ÅÆ‰ªñË≥áÁî£„ÅåÈÅ©Â∫¶„Å´ÂàÜÊï£',
    diagnosis: 'ÈùûÂ∏∏„Å´Áæé„Åó„ÅÑ„Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Åß„Åô„ÄÇÈöô„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„É™„Çπ„ÇØ„Å®„É™„Çø„Éº„É≥„ÅÆ„Éê„É©„É≥„Çπ„ÅåÂèñ„Çå„Å¶„Åä„Çä„ÄÅ2026Âπ¥„ÅÆ„Å©„Çì„Å™Áõ∏Â†¥„Å´„ÇÇÂØæÂøú„Åß„Åç„ÇãÊüîËªüÊÄß„ÇíÊåÅ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ',
    newsForecast: 'Â∏ÇÂ†¥„ÅåÊ∑∑‰π±„Åó„Å¶„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„ÅÆË≥áÁî£„ÅØËªΩÂÇ∑„ÅßÊ∏à„Åø„ÄÅÂõûÂæ©„ÇÇÊó©„ÅÑ„Åß„Åó„Çá„ÅÜ„ÄÇÂàÜÊï£ÊäïË≥á„ÅÆÂäπÊûú„Åß„ÄÅ‰∏Ä„Å§„ÅÆË≥áÁî£„ÇØ„É©„Çπ„ÅÆ‰∏ãËêΩ„Çí‰ªñ„Åå„Ç´„Éê„Éº„Åó„Å¶„Åè„Çå„Åæ„Åô„ÄÇ',
    cleanupAdvice: [
      { action: '‚ú® Á£®„Åè', description: 'ÁèæÁä∂Á∂≠ÊåÅ„ÅßOKÔºÅÂπ¥„Å´1Âõû„ÅÆ„É™„Éê„É©„É≥„Çπ„ÅßÊØîÁéá„ÇíË™øÊï¥„Åô„Çã„Å†„Åë„ÅßÂçÅÂàÜ„Åß„Åô„ÄÇ' },
      { action: 'üéÆ ÈÅä„Å∂', description: '„ÇÇ„ÅóÂÜíÈô∫„Åó„Åü„ÅÑ„Å™„Çâ„ÄÅË≥áÁî£„ÅÆ5%‰ª•ÂÜÖ„Åß„Äå„Çµ„ÉÜ„É©„Ç§„ÉàÊû†ÔºàÂÄãÂà•Ê†™„ÇÑ„ÇØ„É™„Éó„ÉàÔºâ„Äç„ÇíÊ•Ω„Åó„Çì„Åß„Åø„Å¶„ÅØÔºü' }
    ]
  },
  landlord: {
    type: 'landlord',
    emoji: 'üè†',
    title: '‰∏çÂãïÁî£ÂÅèÈáç„ÅÆÂ§ßÂÆ∂„Åï„ÇìÂûã',
    condition: '‰∏çÂãïÁî£ Ôºû 50%',
    diagnosis: 'Ë≥áÁî£„ÅÆÂÆü‰ΩìÊÄß„ÅØÈ´ò„ÅÑ„Åß„Åô„Åå„ÄÅÊµÅÂãïÊÄßÔºà„Åô„Åê„Å´ÁèæÈáëÂåñ„Åß„Åç„Çã„ÅãÔºâ„Å´Êá∏Âøµ„ÅÇ„Çä„ÄÇ‰∏çÂãïÁî£„ÅØÂÆâÂÆö„Åó„ÅüÂèéÂÖ•Ê∫ê„Å´„Å™„Çä„Åæ„Åô„Åå„ÄÅ„ÅÑ„Åñ„Å®„ÅÑ„ÅÜÊôÇ„Å´ÊèõÈáë„ÅåÈõ£„Åó„ÅÑ„Éá„É°„É™„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ',
    newsForecast: 'ÈáëÂà©‰∏äÊòáÂ±ÄÈù¢„Åß„É≠„Éº„É≥„ÅÆËøîÊ∏àË≤†ÊãÖÂ¢ó„ÄÅ„Åæ„Åü„ÅØ‰∏çÂãïÁî£Â∏ÇÊ≥Å„ÅÆÂÜ∑„ÅàËæº„Åø„ÅåÁõ¥ÊíÉ„Åô„ÇãÂèØËÉΩÊÄß„ÄÇ2026Âπ¥„ÅØÊó•ÈäÄ„ÅÆÂà©‰∏ä„ÅíÁ∂ôÁ∂ö„Åå‰∫àÊÉ≥„Åï„Çå„ÄÅÂ§âÂãïÈáëÂà©„É≠„Éº„É≥„Å´„ÅØÁâπ„Å´Ê≥®ÊÑè„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ',
    cleanupAdvice: [
      { action: 'üßπ Êã≠„Åè', description: 'ÂÄüÂÖ•ÊØîÁéá„ÅÆÁ¢∫Ë™ç„ÄÇÈáëÂà©‰∏äÊòá„Å´ÂÇô„Åà„Å¶„ÄÅËøîÊ∏àË®àÁîª„ÇíË¶ãÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' },
      { action: '‚ú® Êãæ„ÅÜ', description: '„Åô„Åê„Å´Âãï„Åã„Åõ„Çã„ÄåÊµÅÂãïÊÄß„ÅÆÈ´ò„ÅÑË≥áÁî£ÔºàÊ†™„ÉªETF„ÉªÁèæÈáëÔºâ„Äç„ÇíÁ¢∫‰øù„Åó„Å¶„ÄÅÊÄ•„Å™Âá∫Ë≤ª„Å´ÂÇô„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ' }
    ]
  }
};

function calculateStats(portfolio: PortfolioData): DiagnosisResult['stats'] {
  const { stocks, realEstate, gold, mutualFunds, crypto, cash, other } = portfolio;
  
  // ÊîªÊíÉÂäõ: Ê†™„ÉªÊöóÂè∑Ë≥áÁî£„Éª„Åù„ÅÆ‰ªñ„ÅåÈ´ò„ÅÑ„Åª„Å©‰∏äÊòá
  const attack = Math.min(100, (stocks * 0.8 + crypto * 1.2 + other * 0.5 + mutualFunds * 0.4));
  
  // Èò≤Âæ°Âäõ: Èáë„ÉªÁèæÈáë„Éª‰∏çÂãïÁî£„ÅåÈ´ò„ÅÑ„Åª„Å©‰∏äÊòá
  const defense = Math.min(100, (gold * 1.2 + cash * 1.0 + realEstate * 0.6 + mutualFunds * 0.3));
  
  // ÊµÅÂãïÊÄß: ÁèæÈáë„ÉªÊ†™„ÉªETF„ÅåÈ´ò„ÅÑ„Åª„Å©‰∏äÊòá„ÄÅ‰∏çÂãïÁî£„ÅåÈ´ò„ÅÑ„Å®‰∏ã„Åå„Çã
  const liquidity = Math.min(100, Math.max(0, (cash * 1.2 + stocks * 0.8 + mutualFunds * 0.9 + crypto * 0.6) - (realEstate * 0.3)));
  
  // „Ç§„É≥„Éï„É¨ËÄêÊÄß: Ê†™„ÉªÈáë„Éª‰∏çÂãïÁî£„ÉªÊöóÂè∑Ë≥áÁî£„ÅåÈ´ò„ÅÑ„Åª„Å©‰∏äÊòá„ÄÅÁèæÈáë„ÅåÈ´ò„ÅÑ„Å®‰∏ã„Åå„Çã
  const inflationResist = Math.min(100, Math.max(0, (stocks * 0.7 + gold * 1.0 + realEstate * 0.8 + crypto * 0.6 + mutualFunds * 0.5) - (cash * 0.4)));
  
  return {
    attack: Math.round(attack),
    defense: Math.round(defense),
    liquidity: Math.round(liquidity),
    inflationResist: Math.round(inflationResist)
  };
}

function determineDiagnosisType(portfolio: PortfolioData): DiagnosisType {
  const { stocks, realEstate, gold, mutualFunds, crypto, cash } = portfolio;
  
  // „Çø„Ç§„Éó1: „ÇÆ„É£„É≥„Éñ„É©„ÉºÂûã - ÊöóÂè∑Ë≥áÁî£ + ÂÄãÂà•Ê†™ > 60%
  if (crypto + stocks > 60) {
    return 'gambler';
  }
  
  // „Çø„Ç§„Éó2: ÈáëÂ∫´Áï™Âûã - ÁèæÈáë + Èáë > 70%
  if (cash + gold > 70) {
    return 'safekeeper';
  }
  
  // „Çø„Ç§„Éó3: „Ç§„Éä„Ç¥Âûã - ÊöóÂè∑Ë≥áÁî£ > 30% „Åã„Å§ Êäï‰ø°/ETF < 20%
  if (crypto > 30 && mutualFunds < 20) {
    return 'trendy';
  }
  
  // „Çø„Ç§„Éó5: Â§ßÂÆ∂„Åï„ÇìÂûã - ‰∏çÂãïÁî£ > 50%
  if (realEstate > 50) {
    return 'landlord';
  }
  
  // „Çø„Ç§„Éó4: ÂÑ™Á≠âÁîüÂûã - Êäï‰ø°/ETF„Åå40„Äú60%„ÄÅ„Åã„Å§ÈÅ©Â∫¶„Å´ÂàÜÊï£
  if (mutualFunds >= 40 && mutualFunds <= 60) {
    return 'balanced';
  }
  
  // „Éá„Éï„Ç©„É´„Éà: ÊúÄ„ÇÇÊØîÁéá„ÅåÈ´ò„ÅÑË≥áÁî£„Å´Âü∫„Å•„ÅÑ„Å¶Âà§ÂÆö
  const maxValue = Math.max(stocks, realEstate, gold, mutualFunds, crypto, cash);
  
  if (maxValue === crypto || maxValue === stocks) return 'gambler';
  if (maxValue === cash || maxValue === gold) return 'safekeeper';
  if (maxValue === realEstate) return 'landlord';
  if (maxValue === mutualFunds) return 'balanced';
  
  return 'balanced';
}

export function diagnosePortfolio(portfolio: PortfolioData): DiagnosisResult {
  const type = determineDiagnosisType(portfolio);
  const baseResult = diagnosisData[type];
  const stats = calculateStats(portfolio);
  
  return {
    ...baseResult,
    stats
  };
}

export function validatePortfolioTotal(portfolio: PortfolioData): boolean {
  const total = Object.values(portfolio).reduce((sum, val) => sum + val, 0);
  return Math.abs(total - 100) < 0.01;
}

